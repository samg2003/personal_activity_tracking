# Backlog
- [24] `streakFor` doesn't respect activity schedule. A weekly MWF activity breaks its streak on Tue/Thu because those days have no completion log. Should skip non-scheduled days (like it already skips vacation days) using `scheduleActive(on:)`. [AI found]
- [25] `overallScore` divides by `topLevelActivities.count` for every day — but not all activities are scheduled every day. A MWF activity penalizes Tue score. Should divide by count of activities where `shouldShow(activity, on: date)` is true for that specific day. [AI found]
- [26] `completionRate(for:)` in AnalyticsView counts `sessionsPerDay(on:)` days but never checks if the activity was actually scheduled on that day via `shouldShow`. A weekly activity gets expected=7 sessions over 7 days instead of the correct 3. [AI found]
- [27] `AnalyticsView.topLevelActivities` filters `!isArchived` — archived activities that were active in the last 7 days disappear from analytics entirely (streaks, completion rates, insights). Should include stopped-but-recently-active activities in analytics calculations, or at least in the "last 7 days" window. [AI found]
- [28] Dashboard `pendingTimed` uses `activity.schedule.type` (current) instead of `scheduleActive(on: today).type`. If a sticky activity was changed to daily via "Future Only", past-day browsing would still filter by current schedule type. Same for `stickyPending`. [AI found]
- [29] `pendingTimed` and `pendingTimedIncludingPartial` are identical computed properties (lines 56-73 in DashboardView). One is dead code — should be removed or differentiated. [AI found]
- [30] Activity search in `ActivitiesListView` only matches on container names, not children. Searching "Journal" won't find it if "Morning Routine" container is collapsed. Should search across children names too. [AI found]
- [31] Import doesn't validate duplicate IDs or handle conflicts with existing data gracefully. If you import twice, you get duplicate activities. Should either merge-by-ID or warn before replacing. [AI found]
- [32] `completionFraction` in DashboardView uses `activity.isMultiSession` and `activity.timeSlots.count` (current) instead of `sessionsPerDay(on: today)` (snapshot-aware). Historical multi-session changes won't reflect correctly in the progress bar. [AI found]
- [33] No confirmation dialog when deleting an activity from the Activities tab that has many existing logs. Only the container "Remove Everywhere" has a destructive warning. Direct delete on a top-level activity with 100+ logs should warn about data loss. [AI found]

### Core Thesis Gaps — "Daily Chores → Goals → Progress"
- [34] **No Goal entity.** The app tracks activities but has no concept of a "Goal" (e.g., "Get healthier", "Read 24 books this year", "Lose 10kg by June"). Activities exist in isolation — there's no way to group activities toward an overarching objective and see aggregate progress. Categories group by domain (Health, Productivity) but don't represent measurable outcomes. **Suggestion**: Add a `Goal` model with title, target metric, deadline, and linked activities. Each Goal gets a progress dashboard showing how contributing activities collectively drive toward it. [AI found — core thesis]
- [35] **Analytics are per-activity, never goal-level.** Streaks, completion rates, heatmaps, and value charts all operate on individual activities. There's no "How is my Health goal doing overall?" view. The `weight` field exists on activities but isn't used in any meaningful rolled-up score beyond container partial completion. **Suggestion**: Add goal-level analytics: weighted aggregate score across linked activities, trend over time, projected completion date. [AI found — core thesis]
- [36] **No weekly/monthly progress reports or summaries.** Analytics page shows a live 7-day snapshot — but there's nothing that says "This week you completed 85% vs 72% last week" or "This month your top improvements were X, Y, Z". No sense of narrative progress over time. **Suggestion**: Add a weekly summary card (auto-generated or push-notified) comparing this week vs last week, highlighting wins and areas to improve. Monthly rollup with trends. [AI found — core thesis]
- [37] **Encouragement bar is generic, not goal-aware.** The encouragement banner shows streak highlights and most improved, but it doesn't know about user goals. It can't say "You're 60% toward your reading goal!" or "At this pace, you'll hit your fitness target by March." **Suggestion**: Once Goals exist, the encouragement bar should prioritize goal-relevant nudges and milestone celebrations. [AI found — core thesis]
- [38] **No milestone/checkpoint system.** Long-term goals need intermediate milestones (e.g., "Read Book #6/24"). There's no way to define or celebrate milestones within the app. Completing 30 consecutive days of meditation should feel different from day 1 — but the app lacks any milestone or celebration system beyond the streak counter. **Suggestion**: Define milestones at 7d, 30d, 90d, 365d streaks and custom goal checkpoints. Show celebration UI and optionally notify. [AI found — core thesis]
- [39] **Category scorecards are too shallow.** AnalyticsView calculates a per-category completion rate for 7 days only. There's no 30-day or 90-day view (despite REQUIREMENTS.md specifying 7/30/90 days). No per-activity drilldown from the scorecard. No trend comparison (this month vs last month). **Suggestion**: Add time-range picker to scorecards (7/30/90 days as spec'd). Show trend arrow comparing to previous period. Allow tap-to-drill-down into per-activity breakdown. [AI found — core thesis]
- [40] **Two types of goals exist — app supports neither.** Some goals are **consistency-based** ("Better hygiene" = just do shower/brush/nails every day — success = high completion rate). Others are **metric-based** ("Reduce body fat %" = track a number moving in a direction — success = the number improving). The Goal model needs to support both: consistency goals measure activity adherence, metric goals measure an outcome KPI changing over time. e.g., "Reduce Body Fat %" has daily chores (creatine, strength training, protein shakes) but success is measured by a separate periodic measurement (body fat % going down). [AI found — core thesis]
- [41] **No outcome metric tracking.** For "Reduce body fat %" the user tracks daily chores (train, eat protein, take creatine) but also needs to periodically measure the OUTCOME (body fat %, weight) — maybe weekly. These periodic measurements are different from daily activities: they happen on their own cadence, they have a direction (↓ for fat, ↑ for deadhang time), and they're the real proof the daily work is paying off. Currently the app has no concept of "outcome metrics" vs "input activities." **Suggestion**: Add `OutcomeMetric` model (name, unit, direction, measurement cadence) linked to Goals. Allow periodic logging of measurements. Show trendline on goal dashboard. e.g., "Deadhang: 30s → 45s → 60s over 3 months." [AI found — core thesis]
- [42] **Activities can only belong to one container — but goals need many-to-many linkage.** "Strength training" contributes to BOTH "Reduce Body Fat %" AND "Improve Cardio/Endurance." "Swimming" improves cardio AND burns fat. Currently activities have a single parent container. Goals need many-to-many: one activity can contribute to multiple goals, and one goal can draw from activities across different categories/containers. **Suggestion**: Goal-Activity is a junction table with optional weight (how much does this activity matter for this goal). [AI found — core thesis]
- [43] **No correlation between daily work and outcome results.** The most powerful insight the app could give: "When you maintained >80% on strength training + protein shakes, your body fat dropped 1% that month. When you dropped below 50%, it stalled." Currently analytics show activity completion and value trends independently — there's no view that overlays "what I did" with "what happened to my outcome." **Suggestion**: On metric-goal dashboards, overlay activity consistency line with outcome trendline so the user sees cause and effect. [AI found — core thesis]
- [44] **Mixed-cadence activities under one goal can't be visualized together.** "Better Hygiene" includes brush teeth (2x daily), shower (daily), nail clipping (weekly), hair trimming (monthly), laundry (weekly). These all run on different schedules but the goal view needs to show them together as one coherent picture. Currently there's no way to normalize and compare activities with different frequencies into a single goal-level score. **Suggestion**: Goal-level scoring should normalize each activity's completion rate regardless of its schedule (weekly activity at 100% = daily activity at 100% = both contribute equally to goal health). [AI found — core thesis]
- [45] **No "baseline → current → target" progression.** For metric goals, the user needs: "I started deadhanging 30s, I'm at 45s now, my target is 90s — I'm 33% there." This requires storing a baseline value, comparing to latest measurement, and showing progress toward target. Currently there's no start point, no directional tracking, no "% toward goal." **Suggestion**: When creating a metric goal, optionally record baseline. Auto-calculate progress toward target from latest measurement. Show as progress arc or bar on goal card. [AI found — core thesis]

# Promoted for human review 
- [23] Big change, Not sure how to handle this... but right now changing container or any activity changes past records. That should not happen always.. if i change who are container sub-children, it shouldnt change past records.. analytics wont change too much either anyways here. For activity maybe include stop doing it thingy.. but even edit of cadence etc.. shouldnt always change past records.. maybe make these changes like google calendar (ask for future changes only, all changes).. but then if it does change past values.. data needs to be preserved so take smart actions and you might have to restrict what can be changed for past ones exclusively, etc.
  - AI Reply: Implemented via Config Snapshots (ADR-7). New `ActivityConfigSnapshot` model stores time-bounded structural config (schedule, type, time window, target, parent). When editing structural fields of an activity with existing logs, a dialog asks "Future Only" or "All Changes". "Future Only" saves old config as a snapshot, then mutates — analytics uses the snapshot for historical dates. Added `stoppedAt: Date?` on Activity for Stop/Resume tracking. `ScheduleEngine`, `AnalyticsView.completionRate`, and `streakFor` all use version-appropriate config. Stop/Resume buttons in editor + context menus. Stopped badge in activities list. Export/import includes snapshots. Docs updated.
  - Human Feedback: Past view still updating with Future Only. Archive renames item (bad). New sub-activities appear in past. Remove from container needs dialog. Structural/cosmetic detection fragile.
  - AI Reply: 5 fixes: (1) `ScheduleEngine.shouldShow` now uses `scheduleActive(on: date)` (snapshot-aware) instead of `activity.schedule` (current). (2) Simplified edit dialog — always asks "Future Only / All Changes" when activity has logs (removed brittle `hasStructuralChanges`). (3) `createdAt` check in `shouldShow` — new sub-activities don't appear on past dates. (4) "Remove from Container" now shows dialog: "Future Only" (snapshot old parent + archive) vs "Remove Everywhere" (delete). (5) Archived section enhanced with Unarchive + Delete Permanently context menu. Archive does NOT rename — it sets `isArchived = true` and moves to archived section.
- [12] Photo cadence: New `PhotoCadence` enum (everyTime/weekly/monthly/never). `Activity.photoCadence` field added. `AddActivityView` shows cadence picker when photo tracking is enabled (defaults to Weekly). Dashboard completion flow calls `isPhotoDue(for:)` — checks last photo date vs cadence — and shows camera sheet via `CameraView` if behind schedule. User can skip or take photo. Photos saved via `MediaService`.
  - AI Reply: Created `PhotoCadence.swift`, added `photoCadenceRaw` to `Activity` model, integrated picker into `AddActivityView`, added `isPhotoDue(for:)` helper and `photoPromptActivity` sheet to `DashboardView.completeCheckbox`. Full flow: toggle photo → pick cadence → complete activity → camera prompt if overdue → save or skip.
  - Human Feedback: Not seeing this still. Also, have soft way of adding photo always, so like for checkbox, have prompt depending on schedule, for value during value creation have extra button "add photo", if behind still have explicit prompt after entering value, for cumulative you can assume photo won't exist (remove it from the activity creation flow too).
  - AI Reply: Reworked per-type: (1) Cumulative activities — photo toggle now hidden in `AddActivityView` (also resets when switching to cumulative). (2) Value activities — `ValueInputRow` now has `onTakePhoto` callback: inline camera icon button + "Add Photo" in context menu; after `logValue`, if behind on cadence, auto-triggers photo prompt sheet. (3) Checkbox — keeps existing cadence-based prompt after completion. Shared `triggerPhotoPrompt(for:log:)` helper used across both flows.
- [11] Container skip section: `ContainerRowView` header now has context menu with "Complete All", "Skip All Pending" (with reason dialog), and "Undo All" actions. This restores interaction that was lost when the outer dashboard context menu was removed in [14].
  - AI Reply: Added `.contextMenu` to `ContainerRowView`'s header `Button` with Complete All (checkbox children), Skip All Pending (with `confirmationDialog` for reason), and Undo All (when fully completed). Uses existing `pendingChildren`/`completedChildren` computed properties.
  - Human feedback: skipped system is still fucked, now every tag says skip all, complete all. Containers should have that, others should have skip, complete, etc. Also once skipped i can't undo it past the temporary undo period, maybe include skipped section at very bottom. just like completed, and allow things to unskip there. Another bug is once I skip in container, it still has "mark all as done" maybe remove that too.
  - AI Reply: Three fixes: (1) Added **Skipped section** to `DashboardView` below Completed — `DisclosureGroup` with orange styling, skip reason capsules, and **Unskip** button per activity (deletes the skip log). (2) Container `ContainerRowView` — changed "Mark All Done" condition from `doneCount < todayChildren.count` to `!pendingChildren.isEmpty` so it hides when only skipped children remain. (3) Context menu now uses `!pendingChildren.isEmpty` and `!completedChildren.isEmpty` independently so Complete All + Undo All can both appear when some are completed and some are pending. Non-container `ActivityRowView` already had correct individual Skip/Complete menu — verified no leaking.
  - Human feedback: Container skip is not going to skipped section after skip all.
  - AI Reply: Root cause was `isSkipped` only checked direct skip logs — containers don't get their own skip log, children do. Fixed `isSkipped` to be container-aware (all today-applicable children skipped → container is skipped). Also fixed `unskipActivity` to unskip all children for containers, and `skipReason` to return first child's reason. Unskip button now says "Unskip All" for containers.
- [19] Same activity should be allowed to be done multiple times in a day specifically Morning, afternoon, and evening.. this might not be a simple change look into it carefully
  - AI Reply: Implemented multi-session support. New `timeSlotsData` on Activity stores `[TimeSlot]` array. New `timeSlotRaw` on ActivityLog disambiguates which session was completed/skipped. Dashboard expands multi-session activities into one row per time slot, each independently completable. `AddActivityView` has "Repeat across time periods" toggle with Morning/Afternoon/Evening checkboxes. `completionFraction` and analytics `completionRate` count per-session. Export/import DTOs updated. Fully backward compatible — existing activities work unchanged.
- [20] let's revamp activities page. Goal here is to make it really easy to edit, add and organize activites. Have easy way to create dummy containers, and activities. Organizing sub-actions in containers ... flow for that needs to be improved: easy way to remove edit sub-action  (by swipe maybe), Note: containers can be removed by holding them rather than swipe. right now containers are first class as actions in view kinda.. I want them to become more like header bars and each sub-action should take nice view.. 
  - AI Reply: Redesigned `ActivitiesListView`: containers now render as **section headers** (colored accent bar, icon, name, child count badge, expand/collapse chevron) with context menu (Edit Container, Apply Style, Archive, Delete). Sub-activities are full rows with **swipe actions** (Edit, Delete) and context menu (Edit, Remove from Container, Archive, Delete). Added **quick-add `+` button** on container headers → opens `AddActivityView` pre-configured with that container as parent via new `presetParent` parameter. Enriched `infoTags`: time slot, multi-session (N× Daily), photo cadence, notes enabled. Also addresses [9] feedback.



# Human Approved Bugs:
- [7] Undo toast position: Moved from bottom to top of screen so it doesn't overlap with FAB or other bottom UI. Animation updated to slide down from top. Test: Complete/uncomplete any activity → verify undo toast appears at the top.
  - AI Reply: Fixed — `UndoToastModifier` changed from `ZStack(alignment: .bottom)` to `.top` with matching slide-down animation offset.
- [2] Edit/Undo past actions: Cumulative activities now have "View Entries" in context menu everywhere (both ALL DAY rings and time-slot rows). Long-press a cumulative ring → "View Entries" → opens `CumulativeLogSheet` with swipe-to-delete individual logs and Save confirmation. Works for both completed and non-completed cumulative activities.
  - Human Feedback: I cant add cumulative one unless it's completed.. I want to in-general be allowed to update cumulative ones same way even when they are not completed
  - AI Reply: Fixed — removed `currentValue != nil` guard so "View Entries" is always available in context menu for cumulative activities, regardless of completion status.
  - Human feedback: I still don't know how to edit it in UI like remove old inputs for non completed cumulative actions.
  - AI Reply: Root cause found — cumulative activities show in the ALL DAY section via `CumulativeRingView` which had no context menu (only tap-to-add). Added context menu with "Add Entry" and "View Entries" to `CumulativeRingView`, wired through `AllDaySection` to open `CumulativeLogSheet`. Long-press the ring circle → "View Entries" to manage individual logs.
- [13] Flat progress bars for ALL DAY + master bar: `CumulativeRingView` redesigned from 60x60 circular ring to flat horizontal row. Master `ProgressRingView` also flattened from 100px circle to thick 14px gradient progress bar with percentage label.
  - AI Reply: Both rings converted to flat bars. `CumulativeRingView` is now a compact row (icon + name + 6px bar + value + plus button). `ProgressRingView` is a 14px thick rounded gradient bar with "Today's Progress" label and percentage — ~54px total vs 110px. `AllDaySection` changed from horizontal ScrollView to vertical stacking.
  - Human feedback: Do this for Whole day completion ring too → Done (see above).
- [14] Context menu standardization: Removed Edit/Delete/View Details from dashboard context menus — dashboard is now action-only (Skip, Complete, Undo, Add Entry, View Entries). Edit/Delete/Archive moved to new Activities management tab.
  - AI Reply: Removed outer `.contextMenu` from `DashboardView.activityView(for:)` and `detailActivity` state/sheet. Each row type already has its own action-oriented context menu. Management operations now live in `ActivitiesListView` (Activities tab).

- [10] Vacation analytics: `completionRate(for:)` now excludes vacation days from denominator — previously divided by 7.0 which penalized activities during vacation. `HeatmapView` already displays vacation cells (blue + ✈️ icon) and tooltip. `streakFor`, `mostImproved`, `overallScore` all already handled vacations. `ValueChartView` naturally excludes vacations (data-point driven).
  - AI Reply: The only remaining gap was `completionRate` which divided by 7.0 regardless of vacation days. Now counts only non-vacation eligible days and excludes vacation-day completions from numerator.

- [8] Photo adding for activities: "View Details" context menu now works (fixed broken `NavigationLink` — replaced with `Button` + `.sheet`). Long-press any activity → "View Details" → `ActivityDetailView` with camera for photo-enabled activities.
  - Human feedback: There is no view detail option when I long press on any activity still. Also that sounds like a bad menthodology.. ask for cadence of photo capture for photo enabled activities during activity creation. And request user to ask for photo at that cadence, (everytime, weekly, monthly, etc. and if user hasnt provided photo within that period ask user when completing the action.). Make IT easy to add photo and part of acceptance flow naturally but only when it's behind shedule
  - AI Reply: Fixed "View Details" — `NavigationLink` doesn't work inside `.contextMenu` in SwiftUI, replaced with `Button` + `.sheet(item:)` for reliable navigation. Photo cadence redesign (prompt during completion flow based on schedule) moved to new bug [12] in backlog — this is a significant design change requiring new model fields, UI in `AddActivityView`, and integration into the completion flow.
  - Human Feedback: I still don't see any option to view details when I long press on any activity. IGNORE THIS FOR NOW, KEEP THIS PENDING, AND WE WILL REVISIT. 

- [9] Activities management tab: Collapsible container children (DisclosureGroup-style with dropdown arrow) + richer info tags (type, schedule, target/unit, HealthKit, photo+cadence, weight). Container children are indented with colored bar and display their own tags.
  - AI Reply: Refactored `activityRow` to `activityRowContent` + expandable children section. Added `FlowLayout` for tag wrapping. Tags show: type badge, schedule, target/unit, HealthKit status, photo cadence, weight (if ≠1). `expandedContainers` state tracks open containers.
  - Human Feedback: I cant see child activites right now, i thought they will be collapsbale somehow.. maybe add dropdown arrow to show them on containers. Also add more relevant things in the tags to know if health kit is enabled, is photo enabled, what's target, everything kinda, you know?
  - AI Reply: Addressed via [20] revamp. Containers now have clear expand/collapse chevron. Children are collapsible rows with full info tags (type, schedule, time slot, multi-session, target, HealthKit, photo+cadence, notes, weight). Swipe-to-edit/delete children added.